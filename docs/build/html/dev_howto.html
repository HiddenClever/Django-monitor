

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How to use (for developers) &mdash; Django-monitor v0.1 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Django-monitor v0.1 documentation" href="index.html" />
    <link rel="next" title="How to use (for admin-users)" href="admin_howto.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="admin_howto.html" title="How to use (for admin-users)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Django-monitor v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="how-to-use-for-developers">
<span id="dev-howto"></span><h1>How to use (for developers)<a class="headerlink" href="#how-to-use-for-developers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="registration-enqueue">
<h2>Registration (Enqueue)<a class="headerlink" href="#registration-enqueue" title="Permalink to this headline">¶</a></h2>
<p>Register the model for moderation using <tt class="docutils literal"><span class="pre">monitor.nq</span></tt>.</p>
<p><strong>Example</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">monitor</span>
<span class="c"># Your model here</span>
<span class="n">monitor</span><span class="o">.</span><span class="n">nq</span><span class="p">(</span><span class="n">YOUR_MODEL</span><span class="p">)</span>
</pre></div>
</div>
<p>The full signature is...</p>
<div class="highlight-python"><pre>monitor.nq(
    model, [rel_fields=[], can_delete_approved=True, manager_name='objects',
    status_name='status', monitor_name='monitor_entry', base_manager=None]
)</pre>
</div>
<p><tt class="docutils literal"><span class="pre">model</span></tt> is the only required argument. Other optional arguments follow:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">rel_fields</span></tt>: List of related fields to be moderated along with this.
Read more details below at <a class="reference internal" href="#dev-howto-rel-moderation"><em>Related moderation</em></a>.</li>
<li><tt class="docutils literal"><span class="pre">can_delete_approved</span></tt>: To prevent admin-users from deleting approved
objects, set this to <tt class="xref docutils literal"><span class="pre">False</span></tt>. Default is <tt class="xref docutils literal"><span class="pre">True</span></tt>. Read more details
below at <a class="reference internal" href="#dev-howto-data-protect"><em>Data-protection</em></a>.</li>
<li><tt class="docutils literal"><span class="pre">manager_name</span></tt>:  We assume that <tt class="docutils literal"><span class="pre">objects</span></tt> is the name of the manager
instance of your model. If you want to use a different name for the
instance, specify the name with <tt class="docutils literal"><span class="pre">manager_name</span></tt> parameter.</li>
<li><tt class="docutils literal"><span class="pre">status_name</span></tt>: By default, the moderation status field is named as
<cite>status</cite>. If you prefer some other name, specify it.</li>
<li><tt class="docutils literal"><span class="pre">monitor_name</span></tt>: A MonitorEntry object will be created to monitor each
object of moderated model. By default, it is referred as <cite>monitor_entry</cite>.
If you prefer some other name, specify it.</li>
<li><tt class="docutils literal"><span class="pre">base_manager</span></tt>: Django-monitor replaces the manager of moderated model
with a special manager class derived from the original. Leave this as None
if you want to use the default manager class. If you have written a custom
manager for the model, you may specify it here.</li>
</ul>
</div>
<div class="section" id="special-model-admin-class">
<h2>Special model-admin class<a class="headerlink" href="#special-model-admin-class" title="Permalink to this headline">¶</a></h2>
<p>We build admin classes for moderated models using <tt class="docutils literal"><span class="pre">MonitorAdmin</span></tt> instead of
django&#8217;s built-in <tt class="docutils literal"><span class="pre">ModelAdmin</span></tt>. Always remember to inherit from
<tt class="docutils literal"><span class="pre">MonitorAdmin</span></tt> when you define model-admin class for your moderated model.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># in your admin.py</span>
<span class="kn">from</span> <span class="nn">monitor.admin</span> <span class="kn">import</span> <span class="n">MonitorAdmin</span>
<span class="k">class</span> <span class="nc">YourModelAdmin</span><span class="p">(</span><span class="n">MonitorAdmin</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="related-moderation">
<span id="dev-howto-rel-moderation"></span><h2>Related moderation<a class="headerlink" href="#related-moderation" title="Permalink to this headline">¶</a></h2>
<p>This is useful when your model is foreign key to some other model and those
model objects are added inline to the former. So when you check and approve
the former model object, you might have verified all those inline objects too
and so they too can be approved along with it. See the <strong>example</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># In admin.py</span>
<span class="k">class</span> <span class="nc">BookAdmin</span><span class="p">(</span><span class="n">MonitorAdmin</span><span class="p">):</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SupplementInline&#39;</span><span class="p">,]</span>

<span class="c"># In models.py</span>
<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Supplement</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">related_name</span> <span class="o">=</span> <span class="s">&#39;supplements&#39;</span><span class="p">)</span>

<span class="n">monitor</span><span class="o">.</span><span class="n">nq</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">rel_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;supplements&#39;</span><span class="p">])</span>
<span class="n">monitor</span><span class="o">.</span><span class="n">nq</span><span class="p">(</span><span class="n">Supplement</span><span class="p">)</span>
</pre></div>
</div>
<p>Remember that both models should be put in moderation queue.</p>
</div>
<div class="section" id="data-protection">
<span id="dev-howto-data-protect"></span><h2>Data-protection<a class="headerlink" href="#data-protection" title="Permalink to this headline">¶</a></h2>
<p>Business organizations may require their applications to prevent admin users
from modifying or deleting approved objects. We allow developers to enable
that using two parameters, <tt class="docutils literal"><span class="pre">protected_fields</span></tt> and <tt class="docutils literal"><span class="pre">can_delete_approved</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">MonitorAdmin.protected_fields</span></tt> can be used to prevent users from changing
values of certain fields in approved objects. Specify the field names as you
would do with <tt class="docutils literal"><span class="pre">readonly_fields</span></tt>. See the <strong>example</strong> below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># in your admin.py</span>
<span class="k">class</span> <span class="nc">YourModelAdmin</span><span class="p">(</span><span class="n">MonitorAdmin</span><span class="p">):</span>
    <span class="n">protected_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;field1&#39;</span><span class="p">,</span> <span class="s">&#39;field2&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">can_delete_approved</span></tt> is an optional parameter you pass to <tt class="docutils literal"><span class="pre">monitor.nq</span></tt>.
Its default value is <tt class="xref docutils literal"><span class="pre">True</span></tt> which allows users to delete all objects. If this
is set to <tt class="xref docutils literal"><span class="pre">False</span></tt>, admin-user can not delete an object once it is approved.
Deleting either un-moderated or pending/challenged objects can be done as usual.
You still can delete approved objects by code or from the django-shell.</p>
</div>
<div class="section" id="creation-of-objects-by-code">
<h2>Creation of objects by code<a class="headerlink" href="#creation-of-objects-by-code" title="Permalink to this headline">¶</a></h2>
<p>The above sections shared tips on how to prepare your application for
moderation by admin-users. What about the objects you create by code? All
objects created by code will be in pending status by default. To moderate
such an object as you wish, get its associated monitor_entry using
<tt class="docutils literal"><span class="pre">monitor.get_monitor_entry</span></tt> and then invoke applicable public method of it.
Available methods of monitor_entry are as follows:</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>approve:</dt>
<dd><div class="first last highlight-python"><pre>approve([user = None, notes = ''])</pre>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>challenge:</dt>
<dd><div class="first last highlight-python"><pre>challenge([user = None, notes = ''])</pre>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>reset_to_pending:</dt>
<dd><div class="first last highlight-python"><pre>reset_to_pending([user = None, notes = ''])</pre>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>moderate (to use when status is available during runtime only):</dt>
<dd><div class="first last highlight-python"><pre>moderate(status, [user = None, notes = ''])</pre>
</div>
</dd>
</dl>
</li>
</ol>
<p><strong>An example usage</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">monitor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_inst</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">arg1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">me</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_monitor_entry</span><span class="p">(</span><span class="n">my_inst</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">me</span><span class="o">.</span><span class="n">approve</span><span class="p">()</span>
</pre></div>
</div>
<p>To let you know which status a particular object is in, there are three more
methods with monitor_entry:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">is_approved</span></tt></li>
<li><tt class="docutils literal"><span class="pre">is_challenged</span></tt></li>
<li><tt class="docutils literal"><span class="pre">is_pending</span></tt></li>
</ol>
<p><strong>An example usage</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">my_inst</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">me</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_monitor_entry</span><span class="p">(</span><span class="n">my_inst</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Will be in pending status by default.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">me</span><span class="o">.</span><span class="n">is_approved</span><span class="p">()</span>
<span class="gp">... </span><span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">me</span><span class="o">.</span><span class="n">is_pending</span><span class="p">()</span>
<span class="gp">... </span><span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">me</span><span class="o">.</span><span class="n">approve</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">me</span><span class="o">.</span><span class="n">is_approved</span><span class="p">()</span>
<span class="gp">... </span><span class="bp">True</span>
</pre></div>
</div>
</div>
<div class="section" id="post-moderation-hook">
<h2>Post-moderation hook<a class="headerlink" href="#post-moderation-hook" title="Permalink to this headline">¶</a></h2>
<p>If you want to perform something after an object is moderated, you can make use
of the <tt class="docutils literal"><span class="pre">post_moderation</span></tt> signal as in the below <strong>example</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">monitor</span> <span class="kn">import</span> <span class="n">post_moderation</span>

<span class="c"># handler_func: function to handle your post moderation activities.</span>
<span class="k">def</span> <span class="nf">handler_func</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c"># sender: MyModel</span>
    <span class="c"># instance: my_model instance that was just moderated</span>
    <span class="k">pass</span>

<span class="c"># MyModel: The model whose moderation you are watching.</span>
<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">post_moderation</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">handler_func</span><span class="p">,</span> <span class="n">sender</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the moderated object will be passed as the <tt class="docutils literal"><span class="pre">instance</span></tt> and its model
as the <tt class="docutils literal"><span class="pre">sender</span></tt>. This will help you to write separate handlers for each model.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How to use (for developers)</a><ul>
<li><a class="reference internal" href="#registration-enqueue">Registration (Enqueue)</a></li>
<li><a class="reference internal" href="#special-model-admin-class">Special model-admin class</a></li>
<li><a class="reference internal" href="#related-moderation">Related moderation</a></li>
<li><a class="reference internal" href="#data-protection">Data-protection</a></li>
<li><a class="reference internal" href="#creation-of-objects-by-code">Creation of objects by code</a></li>
<li><a class="reference internal" href="#post-moderation-hook">Post-moderation hook</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="intro.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="admin_howto.html"
                        title="next chapter">How to use (for admin-users)</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/dev_howto.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="admin_howto.html" title="How to use (for admin-users)"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="index.html">Django-monitor v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Rajeesh Nair.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>